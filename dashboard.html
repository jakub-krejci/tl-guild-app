<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TL Guild - Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.31.0/dist/supabase.min.js"></script>
  <script>
    // ❗ Frontend Supabase client - globálně dostupný
    const supabase = supabase.createClient(
      "https://eorirajluoadqhtjvboz.supabase.co",   // nahraď tvým URL
      "sb_publishable_Y51Oa_SqZagdJhEgP6KQCg_4ux8L4Yt"          // nahraď tvým Anon/Publishable Key
    );
  </script>
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Guild Dashboard</a>
    <button class="btn btn-danger" id="logout">Logout</button>
  </div>
</nav>

<div class="container mt-4">
  <h2>Seznam hráčů</h2>
  <table class="table table-striped" id="players-table">
    <thead>
      <tr>
        <th>Username</th>
        <th>Name</th>
        <th>Class</th>
        <th>Role</th>
        <th>Level</th>
        <th>DKP</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <hr>
  <h2>Vytvořit novou postavu</h2>
  <form id="create-character-form" class="row g-3">
    <div class="col-md-4">
      <input type="text" class="form-control" id="char-name" placeholder="Name" required>
    </div>
    <div class="col-md-4">
      <input type="text" class="form-control" id="char-class" placeholder="Class" required>
    </div>
    <div class="col-md-2">
      <input type="number" class="form-control" id="char-level" placeholder="Level" required>
    </div>
    <div class="col-md-2">
      <button type="submit" class="btn btn-success w-100">Vytvořit</button>
    </div>
  </form>
</div>

<!-- Dashboard JS -->
<script>
document.addEventListener('DOMContentLoaded', () => {

  const token = localStorage.getItem('jwt_token');
  if (!token) {
    alert('Nejste přihlášeni! Přihlaste se přes Discord.');
    window.location.href = '/index.html';
  }

  // --- Načtení hráčů ---
  async function loadPlayers() {
    try {
      const { data, error } = await supabase.from('users').select(`
        id,
        username,
        character:characters(name,class,guild_role,level),
        dkp:dkp(dkp_total)
      `);

      if (error) throw error;

      const tbody = document.querySelector('#players-table tbody');
      tbody.innerHTML = '';

      data.forEach(user => {
        const character = user.character[0] || {};
        const dkp = user.dkp[0]?.dkp_total || 0;

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${user.username}</td>
          <td>${character.name || '-'}</td>
          <td>${character.class || '-'}</td>
          <td>${character.guild_role || '-'}</td>
          <td>${character.level || '-'}</td>
          <td>${dkp}</td>
        `;
        tbody.appendChild(row);
      });

    } catch (err) {
      console.error(err);
      alert('Chyba při načítání hráčů');
    }
  }

  // --- Vytvoření postavy ---
  const form = document.getElementB
